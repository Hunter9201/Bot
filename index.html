<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Planner with Telegram Storage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { 
            background-color: #f8fafc; 
            font-family: 'Inter', sans-serif;
        }
        .progress-bar { 
            height: 10px; 
            border-radius: 6px; 
            background: #e5e7eb; 
            overflow: hidden; 
        }
        .progress-inner { 
            height: 100%; 
            background: linear-gradient(to right, #4f46e5, #9333ea); 
            transition: width 0.5s ease; 
        }
        .subject-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .subject-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .completed {
            text-decoration: line-through;
            opacity: 0.7;
        }
        .hidden {
            display: none !important;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .nav-btn.active {
            background: linear-gradient(to right, #4f46e5, #9333ea);
            color: white;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

<!-- Configuration Modal -->
<div id="configModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg max-w-md w-full mx-4 fade-in">
        <h2 class="text-xl font-bold mb-4 text-indigo-700">Welcome to Study Planner!</h2>
        <p class="text-gray-600 mb-4">Your data will be automatically saved to Telegram.</p>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Your Unique ID</label>
                <input type="text" id="userId" placeholder="Enter your name or ID" 
                       class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                <p class="text-xs text-gray-500 mt-1">This identifies your data in Telegram</p>
            </div>
        </div>

        <div class="mt-6 bg-green-50 p-4 rounded-lg border border-green-200">
            <h3 class="font-semibold mb-2 text-green-800">Ready to Go! 🚀</h3>
            <p class="text-sm text-green-700">Your Telegram bot is configured and ready to save your study data automatically.</p>
        </div>

        <button id="saveConfig" class="w-full bg-indigo-600 text-white py-3 rounded-lg mt-4 hover:bg-indigo-700 font-semibold transition-colors">
            Start Studying Now
        </button>
    </div>
</div>

<!-- Main App -->
<div id="app" class="hidden">
    <header class="bg-gradient-to-r from-indigo-700 to-purple-700 text-white py-4 shadow-lg">
        <div class="max-w-6xl mx-auto px-6 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-extrabold"><i class="fas fa-book mr-2"></i>THE COUNTDOWN</h1>
                <p class="text-xs opacity-90">LDC Study Planner • Telegram Storage Active</p>
            </div>
            <div class="flex items-center space-x-4">
                <span id="syncStatus" class="text-sm bg-white/20 px-3 py-1 rounded-full flex items-center">
                    <i class="fas fa-circle text-green-400 mr-2 text-xs"></i>
                    <span>Ready</span>
                </span>
                <button id="configBtn" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors flex items-center">
                    <i class="fas fa-user mr-2"></i><span id="currentUser">User</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-6xl mx-auto">
            <div class="flex space-x-1 p-4">
                <button onclick="showSection('dashboard')" class="nav-btn active px-4 py-2 flex items-center space-x-2 rounded-lg bg-indigo-50 text-indigo-700 font-medium">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </button>
                <button onclick="showSection('subjects')" class="nav-btn px-4 py-2 flex items-center space-x-2 rounded-lg hover:bg-gray-100 text-gray-700 transition-colors">
                    <i class="fas fa-book-open"></i>
                    <span>Subjects</span>
                </button>
                <button onclick="showSection('study-plan')" class="nav-btn px-4 py-2 flex items-center space-x-2 rounded-lg hover:bg-gray-100 text-gray-700 transition-colors">
                    <i class="fas fa-calendar-plus"></i>
                    <span>Study Plan</span>
                </button>
            </div>
        </div>
    </nav>

    <main class="flex-1 max-w-6xl mx-auto p-6">
        <!-- Dashboard -->
        <div id="dashboard" class="space-y-6">
            <!-- Countdown -->
            <section class="text-center bg-gradient-to-br from-white to-indigo-50 rounded-2xl shadow-md p-6 border border-indigo-100">
                <h2 class="text-2xl font-semibold text-gray-800 mb-2"><i class="fas fa-clock mr-2"></i>Time Until LDC 2025</h2>
                <div id="countdown" class="text-4xl font-bold text-red-600 mb-1">Loading...</div>
                <p id="scareText" class="text-gray-600 italic">Every second counts. Don't waste time!</p>
            </section>

            <!-- Progress & Stats -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Overall Progress -->
                <section class="bg-white rounded-2xl shadow-md p-6">
                    <h2 class="text-xl font-semibold text-indigo-700 mb-4"><i class="fas fa-chart-line mr-2"></i>Overall Progress</h2>
                    <div class="progress-bar mb-2">
                        <div id="progressBar" class="progress-inner" style="width:0%;"></div>
                    </div>
                    <p id="progressText" class="text-sm text-gray-600 text-right">0% Completed</p>
                </section>

                <!-- Study Statistics -->
                <section class="bg-white rounded-2xl shadow-md p-6">
                    <h2 class="text-xl font-semibold text-indigo-700 mb-4"><i class="fas fa-chart-pie mr-2"></i>Study Statistics</h2>
                    <div id="stats" class="grid grid-cols-2 gap-4 text-center">
                        <div class="p-3 bg-blue-50 rounded-lg">
                            <div class="text-2xl font-bold text-blue-600" id="totalSubjects">0</div>
                            <div class="text-sm text-blue-700">Total Subjects</div>
                        </div>
                        <div class="p-3 bg-green-50 rounded-lg">
                            <div class="text-2xl font-bold text-green-600" id="completedSubjects">0</div>
                            <div class="text-sm text-green-700">Completed</div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Quick Actions -->
            <section class="bg-white rounded-2xl shadow-md p-6">
                <h2 class="text-xl font-semibold text-indigo-700 mb-4"><i class="fas fa-bolt mr-2"></i>Quick Actions</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="showSection('subjects')" class="p-4 bg-indigo-50 rounded-lg hover:bg-indigo-100 transition-colors flex items-center justify-center flex-col">
                        <i class="fas fa-book-open text-2xl text-indigo-600 mb-2"></i>
                        <span class="font-semibold text-indigo-700">Manage Subjects</span>
                    </button>
                    <button onclick="showSection('study-plan')" class="p-4 bg-green-50 rounded-lg hover:bg-green-100 transition-colors flex items-center justify-center flex-col">
                        <i class="fas fa-calendar-plus text-2xl text-green-600 mb-2"></i>
                        <span class="font-semibold text-green-700">Study Plan</span>
                    </button>
                    <button onclick="saveToTelegram()" class="p-4 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors flex items-center justify-center flex-col">
                        <i class="fas fa-save text-2xl text-purple-600 mb-2"></i>
                        <span class="font-semibold text-purple-700">Save Now</span>
                    </button>
                </div>
            </section>

            <!-- Recent Activity -->
            <section class="bg-white rounded-2xl shadow-md p-6">
                <h2 class="text-xl font-semibold text-indigo-700 mb-4"><i class="fas fa-history mr-2"></i>Recent Activity</h2>
                <div id="recentActivity" class="text-gray-600">
                    <p class="text-center py-4">No activity yet. Start by adding subjects!</p>
                </div>
            </section>
        </div>

        <!-- Subjects Management -->
        <div id="subjects" class="hidden space-y-6">
            <div class="bg-white rounded-2xl shadow-md p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-indigo-700"><i class="fas fa-book-open mr-2"></i>Manage Subjects</h2>
                    <button onclick="showSection('dashboard')" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                    </button>
                </div>

                <!-- Add Subject Form -->
                <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-semibold mb-3 text-gray-800">Add New Subject</h3>
                    <div class="flex gap-3 flex-col md:flex-row">
                        <input type="text" id="newSubjectName" placeholder="Subject name (e.g., Mathematics)" 
                               class="flex-1 border rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500">
                        <input type="number" id="newSubjectHours" placeholder="Total hours" 
                               class="w-32 border rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500">
                        <button onclick="addSubject()" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold">
                            <i class="fas fa-plus mr-2"></i>Add Subject
                        </button>
                    </div>
                </div>

                <!-- Subjects List -->
                <div id="subjectsList" class="space-y-3">
                    <!-- Subjects will be listed here -->
                </div>
            </div>
        </div>

        <!-- Study Plan -->
        <div id="study-plan" class="hidden space-y-6">
            <div class="bg-white rounded-2xl shadow-md p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-indigo-700"><i class="fas fa-calendar-plus mr-2"></i>Study Plan Generator</h2>
                    <button onclick="showSection('dashboard')" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Study Date</label>
                        <input type="date" id="studyDate" class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Duration (hours)</label>
                        <input type="number" id="studyDuration" value="2" min="0.5" max="8" step="0.5" 
                               class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Select Subjects</label>
                        <select id="studySubjects" multiple class="w-full border rounded-lg px-3 py-2 h-32 focus:ring-2 focus:ring-indigo-500">
                            <!-- Subjects will be populated here -->
                        </select>
                    </div>
                </div>

                <button onclick="generatePlan()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold">
                    <i class="fas fa-magic mr-2"></i>Generate Study Plan
                </button>

                <!-- Generated Plan -->
                <div id="generatedPlan" class="mt-6 p-4 bg-gray-50 rounded-lg hidden">
                    <h3 class="font-semibold mb-3 text-gray-800">Your Study Plan</h3>
                    <div id="planContent">
                        <!-- Plan will appear here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="text-center text-gray-500 text-sm py-4 border-t">
        &copy; 2025 THE COUNTDOWN | Data saved to Telegram automatically
    </footer>
</div>

<script>
// ===== CONFIGURATION =====
const CONFIG = {
    botToken: '8181306647:AAFzwGS7LSLzG3Nki0Fi3nNSG4ZwqDmb79o',
    channelId: '@Lionhunt-bot',
    userId: localStorage.getItem('userId') || '',
    lastSave: localStorage.getItem('lastSave') || null
};

// ===== APP DATA =====
let appData = {
    subjects: [],
    studyPlans: [],
    progress: 0,
    lastSync: null,
    activities: []
};

// ===== TELEGRAM FUNCTIONS =====
async function saveToTelegram() {
    updateSyncStatus('Saving to Telegram...', 'yellow');
    
    try {
        const timestamp = new Date().toISOString();
        const messageText = `📚 STUDY PLANNER DATA\n👤 User: ${CONFIG.userId}\n⏰ ${timestamp}\n\n${JSON.stringify(appData, null, 2)}`;
        
        // Using CORS proxy to bypass restrictions
        const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
        const telegramUrl = `https://api.telegram.org/bot${CONFIG.botToken}/sendMessage`;
        
        const response = await fetch(proxyUrl + telegramUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                chat_id: CONFIG.channelId,
                text: messageText,
                parse_mode: 'HTML'
            })
        });
        
        const result = await response.json();
        
        if (result.ok) {
            updateSyncStatus('Saved to Telegram! ✅', 'green');
            appData.lastSync = new Date();
            CONFIG.lastSave = new Date().toISOString();
            localStorage.setItem('lastSave', CONFIG.lastSave);
            
            // Add activity
            addActivity(`Data saved to Telegram at ${new Date().toLocaleTimeString()}`);
            
            setTimeout(() => updateSyncStatus('Ready', 'green'), 3000);
        } else {
            throw new Error(result.description || 'Telegram API error');
        }
    } catch (error) {
        console.error('Save error:', error);
        updateSyncStatus('Save failed ❌', 'red');
        
        // Fallback: Save to localStorage
        localStorage.setItem('studyPlannerData', JSON.stringify(appData));
        addActivity(`Data saved locally at ${new Date().toLocaleTimeString()} (Telegram failed)`);
        
        setTimeout(() => updateSyncStatus('Ready', 'green'), 3000);
    }
}

async function loadFromTelegram() {
    updateSyncStatus('Loading from Telegram...', 'yellow');
    
    try {
        // Try to load from localStorage first (faster)
        const localData = localStorage.getItem('studyPlannerData');
        if (localData) {
            appData = JSON.parse(localData);
            updateSyncStatus('Loaded from local storage 📱', 'green');
            updateUI();
            return;
        }

        // If no local data, try Telegram (this is simplified - in real app you'd need to fetch message history)
        // For now, we'll initialize with sample data
        initializeSampleData();
        updateSyncStatus('New user - sample data loaded 🎯', 'blue');
        
    } catch (error) {
        console.error('Load error:', error);
        initializeSampleData();
        updateSyncStatus('Loaded sample data 🎯', 'blue');
    }
    
    updateUI();
}

function initializeSampleData() {
    appData = {
        subjects: [
            { id: 1, name: 'Mathematics', hours: 40, completed: false },
            { id: 2, name: 'Physics', hours: 35, completed: false },
            { id: 3, name: 'Chemistry', hours: 30, completed: false },
            { id: 4, name: 'English', hours: 25, completed: true }
        ],
        studyPlans: [],
        progress: 25,
        lastSync: new Date(),
        activities: [
            'Started using Study Planner',
            'Added sample subjects',
            'Completed English subject'
        ]
    };
}

// ===== SUBJECT MANAGEMENT =====
function addSubject() {
    const nameInput = document.getElementById('newSubjectName');
    const hoursInput = document.getElementById('newSubjectHours');
    
    const name = nameInput.value.trim();
    const hours = parseInt(hoursInput.value);
    
    if (!name || isNaN(hours) || hours <= 0) {
        alert('Please enter a valid subject name and hours');
        return;
    }
    
    const newSubject = {
        id: Date.now(),
        name: name,
        hours: hours,
        completed: false
    };
    
    appData.subjects.push(newSubject);
    addActivity(`Added subject: ${name}`);
    updateUI();
    saveToTelegram();
    
    // Clear inputs
    nameInput.value = '';
    hoursInput.value = '';
    nameInput.focus();
}

function toggleSubjectCompletion(subjectId) {
    const subject = appData.subjects.find(s => s.id === subjectId);
    if (subject) {
        subject.completed = !subject.completed;
        const action = subject.completed ? 'completed' : 'marked incomplete';
        addActivity(`${action}: ${subject.name}`);
        updateUI();
        saveToTelegram();
    }
}

function deleteSubject(subjectId) {
    const subject = appData.subjects.find(s => s.id === subjectId);
    if (subject && confirm(`Are you sure you want to delete "${subject.name}"?`)) {
        appData.subjects = appData.subjects.filter(s => s.id !== subjectId);
        addActivity(`Deleted subject: ${subject.name}`);
        updateUI();
        saveToTelegram();
    }
}

// ===== STUDY PLAN =====
function generatePlan() {
    const date = document.getElementById('studyDate').value;
    const duration = parseFloat(document.getElementById('studyDuration').value);
    const subjectSelect = document.getElementById('studySubjects');
    
    if (!date || !duration) {
        alert('Please select date and duration');
        return;
    }
    
    const selectedSubjects = Array.from(subjectSelect.selectedOptions).map(opt => parseInt(opt.value));
    const subjectsToStudy = appData.subjects.filter(s => selectedSubjects.includes(s.id));
    
    if (subjectsToStudy.length === 0) {
        alert('Please select at least one subject');
        return;
    }
    
    const plan = {
        id: Date.now(),
        date: date,
        duration: duration,
        subjects: subjectsToStudy.map(s => ({ id: s.id, name: s.name, hours: s.hours }))
    };
    
    appData.studyPlans.push(plan);
    addActivity(`Created study plan for ${new Date(date).toLocaleDateString()}`);
    
    // Display plan
    const planContent = document.getElementById('planContent');
    planContent.innerHTML = `
        <div class="bg-white p-4 rounded-lg border border-green-200">
            <h4 class="font-semibold mb-2 text-green-700">📅 ${new Date(date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</h4>
            <p class="text-sm text-gray-600 mb-3">⏰ Study Duration: ${duration} hours</p>
            <div class="space-y-2">
                ${subjectsToStudy.map(s => `
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                        <span class="font-medium">${s.name}</span>
                        <span class="text-sm text-gray-500">${s.hours}h total</span>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
    
    document.getElementById('generatedPlan').classList.remove('hidden');
    saveToTelegram();
}

// ===== UI FUNCTIONS =====
function updateUI() {
    updateProgress();
    updateSubjectsList();
    updateStudySubjectsSelect();
    updateStats();
    updateRecentActivity();
    updateCountdown();
}

function updateProgress() {
    const totalSubjects = appData.subjects.length;
    const completedSubjects = appData.subjects.filter(s => s.completed).length;
    const progress = totalSubjects > 0 ? (completedSubjects / totalSubjects) * 100 : 0;
    
    document.getElementById('progressBar').style.width = `${progress}%`;
    document.getElementById('progressText').textContent = 
        `${Math.round(progress)}% Completed (${completedSubjects}/${totalSubjects} subjects)`;
}

function updateSubjectsList() {
    const container = document.getElementById('subjectsList');
    
    if (appData.subjects.length === 0) {
        container.innerHTML = `
            <div class="text-center py-8 text-gray-500">
                <i class="fas fa-books text-4xl mb-3 text-gray-300"></i>
                <p>No subjects added yet. Start by adding your first subject above!</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = appData.subjects.map(subject => `
        <div class="flex items-center justify-between p-4 border rounded-lg subject-card ${subject.completed ? 'completed bg-green-50 border-green-200' : 'bg-white'}">
            <div class="flex items-center space-x-4">
                <input type="checkbox" ${subject.completed ? 'checked' : ''} 
                       onchange="toggleSubjectCompletion(${subject.id})"
                       class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500">
                <div>
                    <span class="font-semibold text-gray-800">${subject.name}</span>
                    <div class="text-sm text-gray-500">${subject.hours} study hours</div>
                </div>
            </div>
            <button onclick="deleteSubject(${subject.id})" class="text-red-500 hover:text-red-700 p-2 rounded-full hover:bg-red-50 transition-colors">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `).join('');
}

function updateStudySubjectsSelect() {
    const select = document.getElementById('studySubjects');
    select.innerHTML = appData.subjects.map(subject => `
        <option value="${subject.id}">${subject.name} (${subject.hours}h) ${subject.completed ? '✅' : ''}</option>
    `).join('');
}

function updateStats() {
    const totalSubjects = appData.subjects.length;
    const completedSubjects = appData.subjects.filter(s => s.completed).length;
    
    document.getElementById('totalSubjects').textContent = totalSubjects;
    document.getElementById('completedSubjects').textContent = completedSubjects;
}

function updateRecentActivity() {
    const container = document.getElementById('recentActivity');
    const recentActivities = appData.activities.slice(-5).reverse();
    
    if (recentActivities.length === 0) {
        container.innerHTML = '<p class="text-center py-4 text-gray-500">No recent activity</p>';
        return;
    }
    
    container.innerHTML = recentActivities.map(activity => `
        <div class="flex items-center space-x-3 p-3 border-b border-gray-100 last:border-b-0">
            <i class="fas fa-circle text-green-400 text-xs"></i>
            <span class="text-sm">${activity}</span>
        </div>
    `).join('');
}

function updateCountdown() {
    const examDate = new Date('2025-12-01');
    const now = new Date();
    const diff = examDate - now;
    
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    
    document.getElementById('countdown').textContent = `${days} days ${hours} hours`;
    
    let scareText = '';
    if (days < 30) scareText = '⏰ FINAL COUNTDOWN! Study hard!';
    else if (days < 90) scareText = '🔥 Time is running out! Stay focused!';
    else if (days < 180) scareText = '⚡ Keep going! Consistency is key!';
    else scareText = '🎯 Good start! Maintain your pace!';
    
    document.getElementById('scareText').textContent = scareText;
}

function updateSyncStatus(message, color = 'green') {
    const status = document.getElementById('syncStatus');
    const icon = status.querySelector('i');
    
    status.innerHTML = `
        <i class="fas fa-circle mr-2 text-xs" style="color: ${getStatusColor(color)}"></i>
        <span>${message}</span>
    `;
}

function getStatusColor(color) {
    const colors = {
        green: '#10B981',
        yellow: '#F59E0B',
        red: '#EF4444',
        blue: '#3B82F6'
    };
    return colors[color] || colors.green;
}

function addActivity(activity) {
    appData.activities.push(activity);
    // Keep only last 10 activities
    if (appData.activities.length > 10) {
        appData.activities = appData.activities.slice(-10);
    }
}

// ===== NAVIGATION =====
function showSection(sectionName) {
    // Hide all sections
    document.getElementById('dashboard').classList.add('hidden');
    document.getElementById('subjects').classList.add('hidden');
    document.getElementById('study-plan').classList.add('hidden');
    
    // Remove active class from all nav buttons
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active', 'bg-indigo-50', 'text-indigo-700');
        btn.classList.add('hover:bg-gray-100', 'text-gray-700');
    });
    
    // Show selected section
    document.getElementById(sectionName).classList.remove('hidden');
    
    // Add active class to current nav button
    event.target.classList.add('active', 'bg-indigo-50', 'text-indigo-700');
    event.target.classList.remove('hover:bg-gray-100', 'text-gray-700');
    
    // Update UI for the section
    if (sectionName === 'study-plan') {
        document.getElementById('studyDate').valueAsDate = new Date();
        updateStudySubjectsSelect();
    }
}

// ===== INITIALIZATION =====
function initApp() {
    // Check if user ID is set
    if (!CONFIG.userId) {
        document.getElementById('configModal').classList.remove('hidden');
    } else {
        startApp();
    }
}

function startApp() {
    document.getElementById('configModal').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');
    document.getElementById('currentUser').textContent = CONFIG.userId;
    
    loadFromTelegram();
    updateCountdown();
    
    // Update countdown every minute
    setInterval(updateCountdown, 60000);
    
    // Auto-save every 2 minutes
    setInterval(saveToTelegram, 120000);
}

// Event Listeners
document.getElementById('saveConfig').addEventListener('click', function() {
    const userId = document.getElementById('userId').value.trim();
    if (!userId) {
        alert('Please enter your name or ID');
        return;
    }
    
    CONFIG.userId = userId;
    localStorage.setItem('userId', userId);
    startApp();
});

document.getElementById('configBtn').addEventListener('click', function() {
    document.getElementById('configModal').classList.remove('hidden');
    document.getElementById('userId').value = CONFIG.userId;
});

// Set default date to today
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('studyDate').valueAsDate = new Date();
    initApp();
});
</script>
</body>
</html>
